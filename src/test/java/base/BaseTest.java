package base;import io.github.bonigarcia.wdm.WebDriverManager;import org.openqa.selenium.WebDriver;import org.openqa.selenium.chrome.ChromeDriver;import org.openqa.selenium.chrome.ChromeOptions;import org.testng.ITest;import org.testng.ITestContext;import org.testng.ITestNGMethod;import org.testng.ITestResult;import org.testng.annotations.*;import utils.ConfigReader;import utils.Log;import utils.ExtentManager;import java.time.Duration;import java.util.HashMap;import java.util.Map;public class BaseTest {    protected WebDriver driver;   //定义driver变量    protected ConfigReader config;    @BeforeSuite(alwaysRun = true)    public void beforeSuite() {        ExtentManager.initReport();//        Log.info("Extent report initialized");  //统一让监听器打印    }    @BeforeClass    public void setUp(ITestContext context){        WebDriverManager.chromedriver().setup();        ChromeOptions options = new ChromeOptions();        // 1️⃣ 关闭 Chrome 密码管理器和密码泄露检测        Map<String, Object> prefs = new HashMap<>();        prefs.put("credentials_enable_service", false);        prefs.put("profile.password_manager_enabled", false);        prefs.put("profile.default_content_setting_values.notifications", 2); // 禁用通知        prefs.put("intl.accept_languages", "en,en_US");        options.setExperimentalOption("prefs", prefs);        // 2️⃣ 其他常用设置        options.addArguments("--disable-notifications");        options.addArguments("--disable-popup-blocking");        options.addArguments("--disable-infobars");        options.addArguments("--incognito");        options.setExperimentalOption("prefs", prefs);        options.addArguments("--lang=en");        driver = new ChromeDriver(options);   //实际创建driver        config = new ConfigReader();        driver.manage().window().maximize();        driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(10));        driver.get(config.getProperty("baseurl"));        context.setAttribute("driver", driver);  // 存入上下文，供监听器获取    }    @AfterClass    public void tearDown(){        if (driver != null) {            driver.quit();            Log.info("Browser closed");        }    }    @AfterSuite(alwaysRun = true)    public void afterSuite() {        ExtentManager.flushReport();        Log.info("Extent report flushed");    }}////// 常规禁用提示//        chromeOptions.addArguments("--disable-notifications");//        chromeOptions.addArguments("--disable-popup-blocking");//        chromeOptions.addArguments("--disable-blink-features=AutomationControlled");////// 禁用密码保护相关功能（这行是关键）//        chromeOptions.addArguments("--disable-features=PasswordLeakDetection,PasswordManagerOnboarding,AutofillServerCommunication,SafeBrowsingEnhancedProtection,SafeBrowsingSecurityUI,SafetyTip");////// 禁用 Chrome 安全服务//        chromeOptions.addArguments("--safebrowsing-disable-download-protection");//        chromeOptions.addArguments("--disable-features=OptimizationHints");////// 禁用凭证服务//        chromeOptions.setExperimentalOption("prefs", Map.ofEntries(//                Map.entry("credentials_enable_service", false),//                Map.entry("profile.password_manager_enabled", false),//                Map.entry("profile.default_content_setting_values.notifications", 2),//                Map.entry("safebrowsing.enabled", false),//                Map.entry("safebrowsing.disable_download_protection", true)//        ));