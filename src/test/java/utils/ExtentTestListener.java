package utils;import com.aventstack.extentreports.Status;import org.testng.ITestContext;import org.testng.ITestListener;import org.testng.ITestResult;import org.openqa.selenium.WebDriver;public class ExtentTestListener implements ITestListener {    @Override    public void onStart(ITestContext context) {        ExtentManager.initReport();        Log.info("Extent Report initialized for suite: " + context.getName());    }    @Override    public void onFinish(ITestContext context) {        ExtentManager.flushReport();        Log.info("Extent Report flushed after suite: " + context.getName());    }    //将内存中所有用例的状态（PASS/FAIL/SKIP）、日志、截图同步到 HTML 报告文件（reports/ExtentReport.html），这一步是报告生成的关键，不能漏。    @Override    public void onTestStart(ITestResult result) {        String testName = result.getMethod().getMethodName(); //获取当前用例的方法名, 作为报告中用例节点的名称。        ExtentManager.createTest(testName);  //调用新版 ExtentManager 的核心方法，自动创建用例报告节点（ExtentTest）+ 绑定到当前线程，后续日志 / 截图都会关联到这个节点。        Log.info("==== Starting test: " + testName + " ====");    }    @Override    public void onTestSuccess(ITestResult result) { //用例无异常、断言通过时触发。        ExtentManager.getTest().log(Status.PASS, "Test passed");        Log.info("✅ " + result.getMethod().getMethodName() + " passed.");    }    @Override    public void onTestFailure(ITestResult result) {        Log.error("❌ " + result.getMethod().getMethodName() + " failed: " + result.getThrowable().getMessage());        ExtentManager.getTest().log(Status.FAIL, result.getThrowable());        // 从属性中取 WebDriver 截图        Object driverObj = result.getTestContext().getAttribute("driver");        if (driverObj instanceof WebDriver) {            String path = ScreenshotUtils.capture((WebDriver) driverObj, result.getMethod().getMethodName());            Log.attachScreenshot(path);        }    }    @Override    public void onTestSkipped(ITestResult result) {        ExtentManager.getTest().log(Status.SKIP, "Test skipped");        Log.warn("⚠️ " + result.getMethod().getMethodName() + " skipped.");    }}